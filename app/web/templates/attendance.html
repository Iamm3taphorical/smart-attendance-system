{% extends "base.html" %}

{% block content %}
<div class="mb-4">
    <h1 style="font-size: 1.875rem; font-weight: 700; margin-bottom: 0.5rem;">Attendance Records</h1>
    <p style="color: var(--text-secondary);">View and manage all attendance records</p>
</div>

<!-- Filters -->
<div class="form-card" style="max-width: 100%; margin-bottom: 2rem;">
    <form method="GET" style="display: flex; gap: 1rem; align-items: end; flex-wrap: wrap;">
        <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
            <label for="date">Date</label>
            <input type="date" id="date" name="date" value="{{ selected_date }}">
        </div>
        <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
            <label for="student_id">Student ID</label>
            <input type="text" id="student_id" name="student_id" value="{{ selected_student }}" placeholder="Filter by ID">
        </div>
        <button type="submit" class="btn btn-primary">Filter</button>
        <a href="{{ url_for('attendance_records') }}" class="btn" style="background: var(--bg-secondary); color: var(--text-primary);">Clear</a>
    </form>
</div>

<!-- Stats Summary -->
<div class="stats-grid" style="margin-bottom: 2rem;">
    <div class="stat-card">
        <div class="stat-title">Total Records</div>
        <div class="stat-value">{{ total_records }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Today's Attendance</div>
        <div class="stat-value text-success">{{ today_count }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Avg Confidence</div>
        <div class="stat-value">{{ "%.1f"|format(avg_confidence * 100) }}%</div>
    </div>
</div>

<!-- Records Table -->
<div class="table-container">
    <div class="table-header">
        <h2 style="font-size: 1.25rem; font-weight: 600;">Records ({{ records|length }} shown)</h2>
        <div style="display: flex; gap: 0.5rem;">
            <a href="{{ url_for('export_csv', date=selected_date, student_id=selected_student) }}" class="btn btn-primary" style="font-size: 0.875rem; padding: 0.5rem 1rem;">
                <i data-lucide="download"></i> Export CSV
            </a>
        </div>
    </div>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Date & Time</th>
                <th>Student</th>
                <th>Student ID</th>
                <th>Confidence</th>
                <th>Location</th>
                <th>Device</th>
            </tr>
        </thead>
        <tbody>
            {% for record in records %}
            <tr>
                <td>#{{ record.id }}</td>
                <td>{{ record.timestamp }}</td>
                <td>
                    <div style="font-weight: 500;">{{ record.name or 'Unknown' }}</div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary);">{{ record.email or 'N/A' }}</div>
                </td>
                <td>{{ record.student_id }}</td>
                <td>
                    <span style="color: {% if record.confidence > 0.8 %}var(--success){% elif record.confidence > 0.6 %}var(--warning){% else %}var(--danger){% endif %}">
                        {{ "%.1f"|format(record.confidence * 100) }}%
                    </span>
                </td>
                <td>{{ record.location or 'N/A' }}</td>
                <td>{{ record.device_id or 'N/A' }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                    No attendance records found. Try adjusting your filters or register some students.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination (if needed in future) -->
{% if records|length >= 100 %}
<div style="margin-top: 1rem; text-align: center; color: var(--text-secondary);">
    Showing first 100 records. Use filters to narrow results.
</div>
{% endif %}
{% endblock %}
